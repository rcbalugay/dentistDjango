{% extends "dashboard/dbase.html" %}
{% load static %}

{% block title %}Book Appointment{% endblock %}

{% block extra_head %}
  {{ block.super }}
  <style>
    .service-grid {
      margin-top: 0.5rem;
    }

    .service-pill {
      display: flex;
      align-items: center;
      padding: 0.6rem 1rem;
      border: 2px solid #6c5ce7;      /* purple border like your theme */
      border-radius: 18px;
      cursor: pointer;
      font-size: 0.95rem;
      color: #4b4f68;
      transition: background 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .service-pill input[type="checkbox"] {
      margin-right: 0.6rem;
      width: 16px;
      height: 16px;
      cursor: pointer;
    }

    .service-pill span {
      flex: 1;
    }

    /* subtle hover / checked feel */
    .service-pill:hover {
      border-color: #4e3fd3;
      box-shadow: 0 4px 12px rgba(108, 92, 231, 0.18);
      background: #f7f6ff;
    }
  </style>
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-12">
    <div class="card">
      <div class="card-body">

        <h4 class="card-title mb-3" style="text-transform: none">Clinic Appointment Form</h4>
        <p class='text-muted'>Please fill out the form below to create an appointment.</p><br>

        <!-- For testing only: display messages
        {% if messages %}
          {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
              {{ message }}
              <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          {% endfor %}
        {% endif %} -->

        <form method="post" action="{% url 'dashboard:appointments_form' %}">
          {% csrf_token %}

          {# Show non-field errors (e.g. from clean()) #}
          {% if form.non_field_errors %}
            <div class="alert alert-danger" role="alert">
              <ul class="mb-0">
                {% for err in form.non_field_errors %}
                  <li>{{ err }}</li>
                {% endfor %}
              </ul>
            </div>
          {% endif %}

          <!-- Row 1: name + phone -->
          <div class="row">
            <div class="form-group col-md-6">
              {{ form.name.label_tag }}
              {{ form.name }}
              {{ form.name.errors }}
            </div>

            <div class="form-group col-md-6">
              {{ form.phone.label_tag }}
              {{ form.phone }}
              {{ form.phone.errors }}
            </div>
          </div>

          <!-- Row 2: email + date + time -->
          <div class="row">
            <div class="form-group col-md-4">
              {{ form.email.label_tag }}
              {{ form.email }}
              {{ form.email.errors }}
            </div>

            <div class="form-group col-md-4">
              {{ form.appointment_date.label_tag }}
              {{ form.appointment_date }}
              {{ form.appointment_date.errors }}
            </div>

            <div class="form-group col-md-4">
              {{ form.appointment_time.label_tag }}
              {{ form.appointment_time }}
              {{ form.appointment_time.errors }}
            </div>
          </div>

          <!-- Row 3: services (full width, pill style) -->
          <div class="form-group">
            <label>Services / Treatment</label>
            {{ form.services.errors }}
            <div class="row service-grid">
              {% for checkbox in form.services %}
              <div class="col-md-6 mb-2">
                <label class="service-pill">
                  {{ checkbox.tag }}
                  <span>{{ checkbox.choice_label }}</span>
                </label>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- Row 4: notes / problem (full width) -->
          <div class="form-group">
            <label for="id_notes">Problem / Notes (optional)</label>
            <textarea class="form-control"
                      id="id_notes"
                      name="notes"
                      rows="3"
                      placeholder="Enter notes about the case"></textarea>
          </div>

          <!-- Buttons -->
          <div class="d-flex justify-content-end">
            <a href="{% url 'dashboard:appointments' %}"
              class="btn btn-light mr-2">
              Cancel
            </a>
            <button type="submit" class="btn btn-primary">
              Register Appointment
            </button>
          </div>

        </form>

      </div>
    </div>
  </div>
</div>
{% endblock %}
